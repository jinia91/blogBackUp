## 데이터링크(Data Link) 계층 개요

> 인접한 네트워크 노드끼리 데이터를 전송하는 기능/ 절차를 제공하고 물리계층에서 발생하는 오류 감지한다.

TCP/IP 모델에서는 1계층과 더불어 네트워크 접속계층으로 분류되는 데이터 링크 계층은 **네트워크 장비간의 신호를 주고받는 규칙**을 정하는 계층으로 하드웨어와 밀접한 연관이 있다.

앞에서 살펴본 1계층 프로토콜과 1계층의 장비들(허브나 리피터)만으로는 단순히 데이터를 전기신호로 변환하거나 해석할 수만 있지  내가 원하는 상대와 통신할 수는 없었다.

물론 단순히 단말 두 대가 1:1로 통신한다면 문제될 것이 없지만,  단말이 여러대 연결되는 LAN으로 확장될 경우 송신한 데이터가 모든 단말로 전달되므로 **비효율**적일 뿐더러, **보안성**에 큰 이슈가 생기고 송수신간 흐름제어도 되지않아 데이터 **충돌**이 일어날 위험성이 크기 때문이다.

하지만 2계층 프로토콜과 장비들은 위의 문제들을 해결할 수단을 제공해준다.

## 이더넷 프로토콜

2계층에서 핵심이 되는 프로토콜은 바로 이더넷 프로토콜이다. 

>이더넷은 네트워크에 연결된 각 기기들이 48비트 길이의 고유의 MAC 주소를 가지고 이 주소를 이용해 상호간에 데이터를 주고 받을 수 있도록 만들어졌다. 전송 매체로는 BNC, UTP, STP 케이블을 사용하며, 각 기기들을 상호 연결시키는 데에는 허브, 네트워크 스위치, 리피터 등의 장치를 이용한다.  <BR>
> -위키백과-

이더넷(Ethernet)은 랜(LAN)에서 데이터를 정상적으로 주고 받기 위해 사용되는 프로토콜로 **개방 시스템간의 연결 설정과 유지 및 제어를 위한** 다양한 규칙들을 정의해 놓고 있다.

### MAC 주소

이더넷프로토콜은 MAC(Media Access Control) 주소라는 것을 정의하는데, 보통 랜카드가 제조될때 새겨지기 때문에 물리주소라고 불리며 **전세계에서 유일한 번호**임을 보장한다.

> 하지만 벤더사에서 규칙을 제대로 지키지 않고 제조하는 경우도 존재하며, MAC주소를 임의로 변경 가능하기 때문에 MAC 주소 충돌 사례도 검색을 통해 꽤 찾아볼 수 있다.

앞서 캡슐화에서 알아본것처럼 송신자의 데이터는 OSI 모델의  3계층까지 내려가면서 헤더라는 부가정보가  붙게되는데, 여기에 더해 2계층에서도 **이더넷 헤더**와 **트레일러** 부착되어 1계층으로 전달 된다.

#### 이더넷 헤더와 트레일러

![enter image description here](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE9XDSZjvF0WYtSmU4pItn1Gn3MhqPpsm3Ng&usqp=CAU)

[이더넷 헤더 구조]

이더넷 헤더에는 목적지의 MAC주소 + 출발지의 MAC주소 + 부가정보(유형)이 담겨 있으며 데이터의 가장 앞쪽에 부착되고,

트레일러는 데이터의 맨 뒤에 부착되며, 데이터 전송중 오류가 발생하는지 확인하는 역할을 한다. 

이렇게 2계층에서 이더넷 헤더와 트레일러가 붙은 데이터를 **프레임**이라 부른다.

또한 여기서 부착된 이더넷 헤더 덕분에, 데이터가 더미허브와 연결된 모든 컴퓨터로 전달되더라도,  목적지의 MAC주소에 해당하지 않는 랜카드들이 해당 정보를 파기하여 보안 이슈를 해결할 수 있게 된다.

**하지만 여전히 불필요한 대상에게 데이터를 전송한다는 점은 비효율적일 뿐더러 완전한 보안성 해결이라고 보긴 힘들다.**
### CSMA/CD

이더넷의 주요기능을 다시 읽어보면  **개방 시스템간의 연결 설정과 유지 및 제어를 위한**프로토콜을 제공한다고 정의했다.

개방시스템과의 연결 설정은 MAC주소로 한다고할 때, 유지 및 제어는 어떤 역할을 할까?

네트워크를 LAN 규모로 볼 때 여러대의 컴퓨터는 하나의 허브에 연결되어있으며, 만약 동시에 데이터 신호를 송출하게 되면 이 신호들은 회선이나 허브안에서 충돌이 일어날 수 있다.

그래서 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 방식인 CSMA/CD(Carrier sense Multiple Access with Collision Detection)를 사용한다.

영어가 너무 길어서 복잡하고 어려워보일 수 있는데 끊어서 살펴보면,

- Carrier Sense(CS) : 송신자가 현재 회선에 신호가 흐르는지 탐지하고
- Multiple Access(MA) : 안전할 경우 송신허용한다는 의미며
- Collision Detection(CD) : 그다음 충돌을 탐지한다는 뜻이다.

즉 송신시 회선에 신호가 흐르는지 탐지후, 안전할경우 1차적으로 송신을 하고, 충돌을 탐지하는 알고리즘으로 충돌 발생시 바로 송신을 멈춰 충돌을 피하는 방식을 말한다.

## 허브의 진화 스위치(L2)

지금까지 이더넷 프로토콜을 통해 1계층의 문제점들, **비효율, 보안성 이슈, 충돌**를 2계층에서  어떻게 해결하는지 살펴보았다.

그런데 위의 방법들을 자세히 살펴보면 공통점을 발견할 수 있다.

바로 1계층의 문제점이 모두 **허브**에서 발생한다는 점이다.

그렇다면 여기서 허브를 개선한다면 네트워크의 연결과 유지 및 제어가 훨씬 수월해지지 않을까?

그래서 등장한 것이 바로 더미허브에 여러가지 기능을 추가한 **스위치**(L2)다.

### 스위치의 MAC 주소 테이블

스위치는 자신의 포트 번호와 해당 포트에 연결된 컴퓨터의 MAC 주소를 등록하는 데이터베이스를 갖고 있으며 이를 MAC 주소 테이블이라고 부른다.

#### MAC 주소 학습 기능

스위치가 켜지면 포트에 연결된 단말로부터 여러 송신 데이터들이 스위치로 들어오게 되는데, 이때 MAC 주소 테이블에 포트, 출발단말MAC 주소를  매핑하여 저장한다.

#### 플러딩(flooding)

스위치로 들어온 데이터는 도착 단말MAC 주소를 MAC 주소 테이블에서 탐색하는데 이떄 아직 주소 테이블이 작성되지 않았을 수 있다.

이경우 송신 포트 이외의 연결된 모든 포트에 데이터를 전송하는 플러딩 현상이 발생한다.
> 더미 허브와 같은 동작

#### MAC 주소 필터링

하지만 `도착 단말 MAC주소`가 `MAC주소 테이블`에 존재하는경우 스위치는 해당 목적지에만 데이터를 전송한다.

이를 통해 불필요한 데이터를 필터링하여 네트워크에 전송하지 않음으로서 보다 안전하고 효율적인 데이터 전송을 수행한다.


### 전이중 통신과 반이중 통신


**전이중 통신**이란 데이터의 송수신을 동시에 하는 방식이며, **반이중통신**은 회선하나로 송신과 수신을 번갈아 하는 통신방식이다.

허브의 경우 반이중통신 방식을 사용하는데 이러면 각 단말이 동시에 송신을 보낼때 허브 안에서 충돌이 발생하게 된다.

![image](https://media.vlpt.us/images/majaeh43/post/3314e1c1-9e6c-4c13-bb89-04c0de58b13a/image.png)

[반이중방식 충돌]


반면 스위치는 **전이중통신방식**을 사용하며,  데이터를 주고받음으로서 충돌을 피하면서 송수신을 가능하게 하여 통신 효율을 높인다.

![image](https://media.vlpt.us/images/minseojo/post/de926bdb-6ff5-4ca9-8fc1-d4df1b250dd0/image.png)

[전이중방식 충돌 회피]


 따라서 스위치를 사용하면 CSMA/CD  메커니즘도 통신 중 필요 없게 된다.

실제로 CSMA/CD는 효율성이 낮다는 이유로 현재는 거의 사용하지 않는다고 한다.


## 더 알아두기 : 주요 기능과 프로토콜들 
### 1. 회선제어
 신호간 충돌이 발생하지 않도록 제어하는 기능
#### ENQ / ACK
- 1:1 연결에서 주로 사용

![첨부 이미지](https://github.com/jinia91/blogBackUp/blob/main/img/fd290080-43d8-475a-a8fa-8b6f80e11867.png?raw=true)

[ENQ/ACK 회선제어 예시 -제로베이스 컴공 네트워크 강의 中]


#### Polling
- 1대 다 연결에서 사용

- select 모드 : 송신자가 수신자들을 선택하여 전송 가능

![첨부 이미지](https://github.com/jinia91/blogBackUp/blob/main/img/ba3d1f09-f2bd-44ff-959e-867334db812f.png?raw=true)

- poll 모드 : 수신자에게 데이터 수신 여부 확인하고 전송하는 기능 

![poll](https://github.com/jinia91/blogBackUp/blob/main/img/72cbf1ed-dc0a-4459-a3e8-63a32888c52b.png?raw=true)


### 2. 흐름제어

네트워크에 연결된 각 단말은 네트워크 처리 능력이 모두 다를것이다. 만약 매우 빠른 데이터 송출을 자랑하는 A단말이 매우 느린 데이터 처리 능력을 가진 B단말에게 A단말 성능 그대로 데이터를 전달할 경우 B단말은 데이터를 제대로 수신받지 못할 것이다.

따라서 2계층에서는 Feedback 방식의 흐름제어를 통해 데이터 전송 속도를 조절하게 된다.

>상위 계층은 Rate기반으로 흐름제어를 함

#### Stop-Wait 방식

![첨부 이미지](https://github.com/jinia91/blogBackUp/blob/main/img/c74b0b44-123c-4295-b10c-fb48eb76280f.png?raw=true)

- 프레임을 한조각 보내고 답장이 오면(Feedback) 그다음조각을 보내는 방식으로 매우 느리다.

#### Sliding-Window 방식

![첨부 이미지](https://github.com/jinia91/blogBackUp/blob/main/img/917f18d1-96a4-4983-8e55-b99c2dffe338.png?raw=true)

- 버퍼를 사용하여 ack 없이 일정양(윈도우 사이즈)만큼 프레임을 연속으로 전송하는 기법

### 3. 오류제어

- 전송중 오류나 손실 발생시 수신측이 에러를 탐지 재전송 요청을 하는 방식
- ARQ : 프레임 손상시 재전송이 수행되는 과정
#### 종류
 - Stop & Wait
 - Go Back N
 

## References
- [제로베이스, 컴퓨터공학 전공자 따라잡기](https://zero-base.co.kr/)
- [미즈구치 카츠야, 모두의 네트워크, 길벗](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9791160505030)
- [https://velog.io/@minseojo/%EB%AA%A8%EB%91%90%EC%9D%98-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A0%95%EB%A6%AC-4](https://velog.io/@minseojo/%EB%AA%A8%EB%91%90%EC%9D%98-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A0%95%EB%A6%AC-4)

