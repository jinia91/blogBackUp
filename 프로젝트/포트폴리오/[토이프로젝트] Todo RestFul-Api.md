# Todo-List Restful API

![첨부 이미지](https://github.com/jinia91/blogBackUp/blob/main/img/108cf512-66c2-4c11-9c8d-104e4d50b3e1.png?raw=true)

[http://3.38.36.238:8080/swagger-ui/index.html](http://3.38.36.238:8080/swagger-ui/index.html)

## GOAL

- 주어진 API Reference에 따라 간단한 Todo 서비스 구현
- 적절한 예외처리와 코너케이스 처리
- 개발환경 / 프로덕드 환경 분리
- 로그 추적기능 추가 / 로그 롤링 정책 작성
- 인가처리
- 이미지 업로드 부가기능
- CI/CD, 배포 및 운영
- 단위테스트, 통합테스트 코드 작성

## 프로젝트 기간
2022.02.04~2022.02.06

## 사용 기술

### 주요 프레임워크 / 라이브러리 

- java 11 openjdk
- SpringBoot 2.6.3
- Spring Data Jpa

### build tool

- gradle

### DB

- 개발환경 : H2
- 프로덕트 : MySql

### infra

- AWS EC2
- AWS S3
- Travis Ci
- Aws CodeDeploy

### 기타 라이브러리

- Lombok
- QueryDsl
- Swagger

### 개발 환경

- IntelliJ
- PostMan
- GitHub
- Mysql Workbench
- H2 console

## 프로젝트 진행 이유?

- 채용과정에서 과제 테스트를 받았는데 생각보다 추가 구현사항이 꽤 되었다.

- api 레퍼런스 자체는 제공되기 때문에 설계에는 문제가 없었지만, restful한 구현 연습과 학습을 위해 욕심을 부려 토이프로젝트급으로 만들어 보았다.

## 주요 구현 내용

### 1. 주어진 API Reference에 따라 간단한 Todo 서비스 구현

- Get, Post, Delete, Put 요청에 따른 restful api 구현 완료
- Get으로 list 요청시 헤이티오스를 통한 다음 상태 전이 제시
- 요구된 스펙대로 예외 처리(403,404,500 등)

### 2. 개발환경 / 프로덕트 환경 분리

- 개발환경시 h2db사용, 개발환경설정 프로필 분리
- 프로덕트환경시 mysql사용, 프로덕트 환경설정 프로필 분리
- 깃헙 dev, main 브랜치 분리하여 dev에서 작업후 병합

### 3. 인가처리
- api 레퍼런스에서 제시한 간단한 쿼리스트링 apikey로 인터셉터를 통해 인가 처리 구현

### 4. 이미지 업로드 모듈
- 이미지 업로드시 todo를 삽입할때 이미지를 바이너리나 파일로 보낼지, 따로 요청을 나눌지 고민하다 기존 코드를 최대한 손대지 않고
유연한 확장 설계를 위해 별도의 Get 요청으로 분리함
- 실무환경이라면 기획자와 클라이언트 개발자와 소통후 결정
- aws s3서버로 파일업로드 후 url을 반환받아 url을 todo에 삽입하는 방식으로 구현
- todo와 url은 1대 다 매핑연관관계로 db에서 관리

### 5. 로그 추적 모듈
- aop를 사용하여 로그 추적 모듈 추가
- 요청이 들어올때 할당 쓰레드 단위로 고유 난수를 붙여 로그 추적토록함
- 롤링정책 설정으로 날짜별 로그파일 저장 및 에러 로그만 별도 저장, 기한은 30일, 60일단위로 폐기

### 6. Ci / Cd
- github, travis , codedeploy를 사용하여 깃헙으로 메인 브랜치가 푸시되거나 병합될 때, 트래비스에서 테스트를 수행, 
빌드후 ec2서버로 보내지면 codedeploy가 쉘스크립트를 실행시켜 자동 배포 릴리즈되도록 구성

### 7. 단위 테스트, 통합 테스트

- 기본기능에 한에 단위 테스트, 통합테스트 코드 구현 완료
- 개발환경에서 정상 테스트 구동 확인
- CI단계에서 정상 테스트 구동 확인

## 느낀점

- 운영단계에 테스트코드를 적용하는건 이번이 처음이였는데 생각보다 고려할게 많고 장애도 많이 터져서 고생했다. 테스트 환경에서의 DB설정, 테스트별 격리, 리플렉션을 사용한 메서드 강제 호출이나 목객체 설정등 여러가지를 배울수 있었다.
<BR>

- CI/CD는 할때마다 엄청 고생하는거 같은데 이참에 도커를 꼭 배워야겠다고 느꼈다. 개발환경과 운영환경이 다르니 고려할 사항도 너무 많고, 쉘스크립트 작성도 리눅스가 익숙치 않아 고생했다.
<BR>

- 요구사항이 단순히 이미지 업로드 모듈로만 되어있어서 이 기능을 별도의 요청으로 뽑아내야하는건지, 아니면 TODO 작성시 한번에 multipart/form으로 보내야할지 , 바이너리코드로 박아 넣을지 고민이 되었다. 사실 이 문제는 실제 앱단계에서 UI와 기획에 따라 갈리는부분이라 기획자, 클라이언트 개발자와의 소통의 필요성을 다시금 느꼈다.
<BR>

- 인가처리를 좀 더 제대로 만들고 싶었는데 시간적 여유가 부족해서 우선순위를 미루다가 결국 간단한 쿼리스트링으로 대체했다.  아쉬움이 많이 남는 부분.
<BR>

- 객체지향 설계, 디자인패턴, 클린코드, 테스트주도 개발, 애자일, MSA 등 현대 소프트웨어 공학의 상당부분은 방법론은 다르지만 그 최종적인 지향점이 `유연한 확장, 쉬운 유지 관리` 이며 최종적으로 `장기적 생산성`의 증진이라고 생각한다. 그런 측면에서 이번 토이 프로젝트로 많은걸 체감하고 배운거 같아서 만족스럽다.


### [깃허브 코드 확인](https://github.com/jinia91/ToDoList_Rest_Api)
